# dts6012m-i2c-esphome
Custom ESPHome component for the DTS6012M time-of-flight distance sensor using its I2C interface.

Most of the code is generated by ChatGPT-4 based on the sensor's datasheet and ESPHome documentation. I didn't bother with so many details, so tread carefully and test thoroughly before using it. This is just a hobby project I bashed by my forehead on the keyboard until I made it work.

Tested with an ESP32 WROOM (denky32) and ESPHome 2025.9.3.

### Distance Cone
From documentation:
![distance-cone-dimensions](image-1.png)

## ⚙️ Hardware Requirements


**Sensor:** DTS6012M time-of-flight distance sensor

**Microcontroller:** ESP32 (recommended) or maybe ESP8266?

**Connections:**

- Sensor Pin 1 **VCC → 3.3V_LASER**
- Sensor Pin 2 **VCC → 3.3V**
- Sensor Pin 3 **TX → SDA pin** of ESP32
- Sensor Pin 4 **RX → SCL pin** of ESP32
- Sensor Pin 5 **GPIO5 → 3.3V**
- Sensor Pin 6 **GND → GND**

![pinout](image.png)

## Wire for I2C Connection


This library targets only the I2C interface of the DTS6012M sensor. Make sure to connect the sensor accordingly. I had sometimes issues when the pin 5 was not HIGH on startup. I suspect brownout.
![i2c-wiring](image-3.png)

## Possible Gotchas
The default I2C address of the DTS6012M sensor is fixed to `0x51`. That is defined in the DTS6012M.h file. Modify, if needed.

# Example ESPHome Configuration
This worked for me. Adjust pins and settings as needed.
```yaml
esphome:
  name: dts6012m-node

esp32:
  board: denky32
  framework:
    type: arduino

# Enable logging
logger:
  level: DEBUG

# Enable Home Assistant API
api:
  encryption:
    key: !secret api_encryption_key

ota:
- platform: esphome
  password: !secret ota_password

wifi:
  use_address: 192.168.1.16
  ssid: !secret wifi_ssid
  password: !secret wifi_password
  fast_connect: True

  # Enable fallback hotspot (captive portal) in case wifi connection fails
  ap:
    ssid: "ESP32_Fallback"
    password: !secret wifi_fallback_outside
    # ap_timeout: 1min

i2c:
  sda: 21
  scl: 18
  scan: false
  # optional: lower clock if unstable
  frequency: 10kHz

captive_portal:

external_components:
  - source: github://ronmarti/dts6012m-i2c-esphome@v0.1
    components: [dts6012m]

dts6012m:
  update_interval: 500ms
  retries: 3
  distance:
    name: "DTS6012M Distance"

sensor:

```

The important part is the `external_components` section, which pulls in the custom DTS6012M component from this repository. Adjust the version tag as needed.

# Development in Container: Docker Compose
For development purposes, you can use the following `docker-compose.yaml` to set up an ESPHome environment with access to USB devices for flashing and monitoring your ESP32 boards.

For `secrets.yaml`, create a file in the project-root directory with your WiFi and OTA credentials, it will be mounted into the container.

Example of `secrets.yaml`:
```yaml
wifi_ssid: "my_wifi_ssid"
wifi_password: "my_wifi_password1234567"
```

## Tips for Deploying Config to Device
Use Chromium-based browser (Edge, Chrome, Brave, etc.) to access the ESPHome dashboard at `http://localhost:6052` (adjust port as needed). Chromium have serial monitoring built-in, I suppose that's why it is needed for the first flash. Then you can use any browser for OTA updates.

For the first upload wiht wifi credentials to enable the OTA updates, you need to connect the ESP32 via USB to your computer and select the appropriate serial port in the ESPHome dashboard. If you have issues with accessing the serial port from within the container, you can bypass by downloading the compiled binary from the container's ESPHome dashboard (Install > Manual Download > Factory Format > Open ESPHome Web) and flashing it using online-loaded esphome dashboard.

## Troubleshooting Problems during Building
Sometimes the local build cache becomes corrupted, especially when you messed up with some external components. To fix this, you can clear the build cache by deleting the `.esphome/build` folder:
```shell
rm -rf /config/.esphome/build
```
Then try to build again.

Sometimes, esphome downloads and cache the external components and until version is changed, it won't download again. To force re-download of the external components, you can delete the `.esphome/downloads` folder:
```shell
rm -rf /config/.esphome/external_components
```
Then try to build again.